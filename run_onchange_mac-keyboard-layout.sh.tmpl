{{ if eq .machine_type "mac" -}}
#!/bin/bash
set -euo pipefail

LAYOUT="de"
MODEL="pc105"
VARIANT="mac"

status="$(localectl status || true)"

if grep -q "X11 Layout: $LAYOUT" <<< "$status" \
   && grep -q "X11 Model: $MODEL" <<< "$status" \
   && grep -q "X11 Variant: $VARIANT" <<< "$status"; then
  echo "Keyboard layout already set to $LAYOUT ($VARIANT), nothing to do."
  exit 0
fi

sudo localectl set-x11-keymap "$LAYOUT" "$MODEL" "" "$VARIANT"
echo "âœ“ Keyboard layout: $LAYOUT ($VARIANT)"
{{- end }}